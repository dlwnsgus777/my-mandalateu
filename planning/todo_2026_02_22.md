# TODO - 2026-02-22

## 체크리스트

- [ ] 로그아웃 기능이 없음
- [ ] 회원가입 정책에 대해서 법적으로 어떻게 자료를 수집할지가 필요함
- [ ] 차라리 OAuth를 하는게 좋을것 같긴함

---

## 상세 계획

### 1. 로그아웃 기능 구현

#### 현재 상황
- 프론트엔드에서 클라이언트 사이드 로그아웃만 구현됨 (Zustand 상태 초기화 + AsyncStorage 삭제)
- 백엔드에 `/api/v1/auth/logout` 엔드포인트 없음
- 문제: 로그아웃 후에도 탈취된 Access Token은 만료(1시간)까지 유효

#### 구현 방안 (단계적 접근)

**Phase 1 - 최소 구현 (단기)**
- 프론트엔드 SettingsScreen에 로그아웃 버튼 UI 추가
  - 현재 `front/src/screens/SettingsScreen/index.tsx`에 로그아웃 버튼 없음
  - `useAuthStore().logout()` 호출 후 로그인 화면으로 이동

**Phase 2 - 서버 사이드 토큰 무효화 (중기)**
- 백엔드: `POST /api/v1/auth/logout` 엔드포인트 추가
- Refresh Token을 DB에 저장하고 로그아웃 시 삭제 처리
  - User 엔티티 또는 별도 테이블에 `refreshToken` 컬럼 추가
  - 토큰 갱신(`/refresh`) 시 DB에 저장된 값과 비교
  - 로그아웃 시 DB에서 해당 토큰 삭제
- Access Token 블랙리스트는 Redis 도입 이전까지 1시간 만료에 의존

**작업 파일**
- `back/src/main/kotlin/com/mandalateu/auth/controller/AuthController.kt` - logout 엔드포인트 추가
- `back/src/main/kotlin/com/mandalateu/auth/service/AuthService.kt` - logout 로직
- `back/src/main/kotlin/com/mandalateu/user/domain/User.kt` - refreshToken 필드 추가
- `front/src/screens/SettingsScreen/index.tsx` - 로그아웃 버튼 UI
- `front/src/api/auth.ts` - logout API 호출 함수

---

### 2 & 3. OAuth 전용 인증으로 전환 (결정 완료: 이메일/비밀번호 완전 대체)

#### 결정 사항
- **회원가입 및 로그인을 OAuth로만 처리** → 이메일/비밀번호 인증 제거
- 비밀번호를 서버에 저장하지 않으므로 개인정보 수집 최소화 → 법적 부담 대폭 감소

#### OAuth 제공자 선택
| 제공자 | 선택 이유 | 비고 |
|--------|-----------|------|
| Google | 글로벌 표준, 구현 레퍼런스 풍부 | **현재 구현 대상** |
| Apple | iOS App Store 필수 정책 | 추후 추가 (App Store 출시 시 필수) |
| Kakao | 국내 사용률 높음 | 미정 |

#### 개인정보 수집 항목 (OAuth 전환 후)
| 항목 | 출처 | 목적 | 보유기간 |
|------|------|------|----------|
| 이메일 | OAuth 제공자 | 계정 식별 | 탈퇴 시까지 |
| 닉네임 | OAuth 제공자 프로필 | 서비스 내 표시 | 탈퇴 시까지 |
| provider / providerId | OAuth 제공자 | 계정 연동 식별 | 탈퇴 시까지 |

> 비밀번호 수집 없음 → 개인정보보호법상 민감 항목 제거, 약관 동의 절차 대폭 단순화

#### 법적 처리
- OAuth 제공자의 개인정보 처리방침에 위임되는 항목 명시 필요
- 서비스 자체 약관에는 OAuth 연동 및 수집 항목(이메일, 닉네임)만 명시
- `planning/legal/privacy_policy.md` - 개인정보 처리방침 초안 작성 필요
- `planning/legal/terms_of_service.md` - 서비스 이용약관 초안 작성 필요

#### 백엔드 구현 계획

**의존성 추가** (`build.gradle.kts`)
```kotlin
implementation("org.springframework.boot:spring-boot-starter-oauth2-client")
```

**제거 대상 코드**
- `AuthController` - `/signup`, `/login` 엔드포인트
- `AuthService` - `signup()`, `login()` 메서드
- `SignupRequest`, `LoginRequest` DTO
- `User.password` 필드, BCrypt 관련 코드

**추가 대상 코드**
- `User` 엔티티에 `provider: String`, `providerId: String` 필드 추가
- `OAuth2SuccessHandler` - 소셜 로그인 성공 시 JWT(Access + Refresh Token) 발급
- `CustomOAuth2UserService` - 소셜 계정 정보로 User 조회/신규 생성
- `SecurityConfig` - OAuth2 로그인 설정 추가, 기존 로컬 인증 제거
- `AuthController` - `/refresh`, `/logout` 만 유지

**작업 파일 (백엔드)**
- `back/build.gradle.kts` - oauth2-client 의존성 추가
- `back/src/main/kotlin/com/mandalateu/user/domain/User.kt` - provider, providerId 추가, password 제거
- `back/src/main/kotlin/com/mandalateu/auth/oauth/CustomOAuth2UserService.kt` - 신규 생성
- `back/src/main/kotlin/com/mandalateu/auth/oauth/OAuth2SuccessHandler.kt` - 신규 생성
- `back/src/main/kotlin/com/mandalateu/common/config/SecurityConfig.kt` - OAuth2 설정 반영
- `back/src/main/kotlin/com/mandalateu/auth/controller/AuthController.kt` - signup/login 제거
- `back/src/main/resources/application.yml` - OAuth 클라이언트 ID/Secret 환경변수 추가

#### 프론트엔드 구현 계획

**라이브러리**
- `@react-native-google-signin/google-signin` - Google OAuth

**제거 대상 코드**
- `SignupScreen` 전체
- `LoginScreen` 이메일/비밀번호 입력 폼
- `auth.ts` - `signup()`, `login()` 함수

**추가 대상 코드**
- `LoginScreen` - "Google로 계속하기" 버튼
- `auth.ts` - `loginWithGoogle()` 함수
  - 소셜 로그인 후 백엔드로 Google ID Token 전달 → JWT 수신
- `RootNavigator` - SignupScreen 라우트 제거

**작업 파일 (프론트엔드)**
- `front/src/screens/LoginScreen/index.tsx` - 소셜 로그인 버튼으로 교체
- `front/src/api/auth.ts` - OAuth 함수로 교체
- `front/src/navigation/RootNavigator.tsx` - Signup 라우트 제거
- `front/src/types/navigation.ts` - Signup 타입 제거

---

## 작업 우선순위 (업데이트)

| 우선순위 | 항목 | 내용 |
|----------|------|------|
| 1 | 로그아웃 UI (Phase 1) | SettingsScreen에 버튼 추가, 즉시 가능 |
| 2 | 백엔드 Google OAuth 전환 | Google ID Token 검증 → JWT 발급 플로우 구현 |
| 3 | 프론트엔드 Google OAuth 전환 | "Google로 계속하기" 버튼, 기존 회원가입 화면 제거 |
| 4 | 서버 사이드 로그아웃 (Phase 2) | Refresh Token DB 저장 + 무효화 |
| 5 | 법적 문서 작성 | 개인정보처리방침, 이용약관 초안 |
| 6 | Apple 로그인 추가 | App Store 출시 시점에 필수 추가 |