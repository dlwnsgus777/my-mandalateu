# 백엔드 작업 계획

> 작성일: 2026-02-16
> 스택: Kotlin · Spring Boot · Gradle · MySQL · JWT

---

## 기술 스택

| 항목 | 선택 |
|------|------|
| 언어 | Kotlin 2.x (JVM 21) |
| 프레임워크 | Spring Boot 3.x |
| 빌드 | Gradle (Kotlin DSL) |
| DB | MySQL 8.x |
| ORM | Spring Data JPA (Hibernate) |
| 인증 | Spring Security + JWT (jjwt) |
| 유효성 검사 | Spring Validation (jakarta) |
| 기타 | kotlin-reflect, kotlin-stdlib |

---

## 도메인 모델

### 용어 정의

| 용어 | 설명 | 구 용어 |
|------|------|--------|
| `Mandalart` | 만다라트 프로젝트 전체 | Project |
| `Strategy` | 핵심 목표를 달성하기 위한 전략 (세부 목표 영역, 9개) | Block |
| `ActionItem` | 전략을 실행하는 구체적 행동 (실행 과제, 9개) | Cell |

### 엔티티 관계

```
User (1) ─── (N) Mandalart (1) ─── (9) Strategy (1) ─── (9) ActionItem
```

### User

| 컬럼 | 타입 | 설명 |
|------|------|------|
| id | BIGINT PK | |
| email | VARCHAR(255) UNIQUE | 로그인 식별자 |
| password | VARCHAR(255) | BCrypt 해시 |
| nickname | VARCHAR(50) | 표시 이름 |
| createdAt | DATETIME | |

### Mandalart

| 컬럼 | 타입 | 설명 |
|------|------|------|
| id | BIGINT PK | |
| userId | BIGINT FK | 소유자 |
| title | VARCHAR(100) | 만다라트 이름 |
| createdAt | DATETIME | |
| updatedAt | DATETIME | |

### Strategy

| 컬럼 | 타입 | 설명 |
|------|------|------|
| id | BIGINT PK | |
| mandalartId | BIGINT FK | |
| position | TINYINT | 0~8 (그리드 위치) |
| title | VARCHAR(100) | 전략 제목 |
| color | VARCHAR(10) NULL | 사용자 지정 색상 (hex) |
| notes | TEXT NULL | 전략 메모 |

### ActionItem

| 컬럼 | 타입 | 설명 |
|------|------|------|
| id | BIGINT PK | |
| strategyId | BIGINT FK | |
| position | TINYINT | 0~8 (Strategy 내 위치) |
| isCenter | BOOLEAN | 중앙 셀 여부 |
| title | VARCHAR(100) | 실행 과제 제목 |
| description | TEXT NULL | 세부 설명 |
| completed | BOOLEAN | 완료 여부 |
| completedAt | DATETIME NULL | 완료 시각 |
| deadline | DATE NULL | 마감일 |
| priority | ENUM('HIGH','MEDIUM','LOW') NULL | 우선순위 |

---

## API 설계

### Base URL
```
/api/v1
```

### 인증 (Auth)

| Method | URL | 설명 | 인증 필요 |
|--------|-----|------|----------|
| POST | `/auth/signup` | 회원가입 | ❌ |
| POST | `/auth/login` | 로그인 → Access/Refresh Token 발급 | ❌ |
| POST | `/auth/refresh` | Access Token 재발급 | ❌ (Refresh Token) |

### 만다라트 (Mandalart)

| Method | URL | 설명 | 인증 필요 |
|--------|-----|------|----------|
| GET | `/mandalarts` | 내 만다라트 목록 조회 | ✅ |
| POST | `/mandalarts` | 만다라트 생성 | ✅ |
| GET | `/mandalarts/{mandalartId}` | 만다라트 상세 (strategies + actionItems 포함) | ✅ |
| PATCH | `/mandalarts/{mandalartId}` | 만다라트 제목 수정 | ✅ |
| DELETE | `/mandalarts/{mandalartId}` | 만다라트 삭제 | ✅ |

### 전략 (Strategy)

| Method | URL | 설명 | 인증 필요 |
|--------|-----|------|----------|
| PATCH | `/mandalarts/{mandalartId}/strategies/{strategyId}` | 전략 수정 (title / color / notes) | ✅ |

### 실행 과제 (ActionItem)

| Method | URL | 설명 | 인증 필요 |
|--------|-----|------|----------|
| PATCH | `/mandalarts/{mandalartId}/strategies/{strategyId}/action-items/{actionItemId}` | 실행 과제 수정 (title / completed / deadline / priority / description) | ✅ |

### 대시보드 (Dashboard)

| Method | URL | 설명 | 인증 필요 |
|--------|-----|------|----------|
| GET | `/mandalarts/{mandalartId}/dashboard/summary` | 전체 진행률 통계 | ✅ |
| GET | `/mandalarts/{mandalartId}/dashboard/weekly` | 주간 완료 현황 (요일별) | ✅ |
| GET | `/mandalarts/{mandalartId}/dashboard/streak` | 연속 달성 기록 | ✅ |
| GET | `/mandalarts/{mandalartId}/dashboard/deadlines` | 다가오는 마감일 목록 | ✅ |

---

## 요청/응답 예시

### POST /auth/signup
```json
// Request
{ "email": "user@example.com", "password": "pass1234", "nickname": "핀" }

// Response 201
{ "id": 1, "email": "user@example.com", "nickname": "핀" }
```

### POST /auth/login
```json
// Request
{ "email": "user@example.com", "password": "pass1234" }

// Response 200
{ "accessToken": "eyJ...", "refreshToken": "eyJ...", "tokenType": "Bearer" }
```

### POST /mandalarts
```json
// Request
{ "title": "건강한 생활 2026", "coreGoal": "건강한 생활" }

// Response 201
{ "id": 1, "title": "건강한 생활 2026", "createdAt": "...", "strategies": [...] }
```

### GET /mandalarts/{mandalartId}
```json
// Response 200
{
  "id": 1,
  "title": "건강한 생활 2026",
  "createdAt": "2026-02-16T00:00:00Z",
  "updatedAt": "2026-02-16T00:00:00Z",
  "strategies": [
    {
      "id": 1,
      "position": 0,
      "title": "운동 루틴",
      "color": "#2196F3",
      "notes": null,
      "actionItems": [
        {
          "id": 1,
          "position": 0,
          "isCenter": false,
          "title": "주 3회 헬스",
          "completed": true,
          "completedAt": "2026-02-15T11:00:00Z",
          "deadline": null,
          "priority": null
        }
      ]
    }
  ]
}
```

### PATCH /mandalarts/{mandalartId}/strategies/{strategyId}/action-items/{actionItemId}
```json
// Request (변경할 필드만 포함)
{ "completed": true }

// Response 200
{ "id": 1, "completed": true, "completedAt": "2026-02-16T10:00:00Z", ... }
```

### GET /mandalarts/{mandalartId}/dashboard/weekly
```json
// Response 200
{
  "weekRange": { "start": "2026-02-10", "end": "2026-02-16" },
  "dailyStats": [
    { "date": "2026-02-10", "dayOfWeek": "MON", "completedCount": 3 },
    { "date": "2026-02-11", "dayOfWeek": "TUE", "completedCount": 0 }
  ],
  "thisWeekTotal": 12,
  "lastWeekTotal": 8,
  "changeRate": 50.0
}
```

### GET /mandalarts/{mandalartId}/dashboard/streak
```json
// Response 200
{ "currentStreak": 5, "bestStreak": 12, "lastCompletedDate": "2026-02-16" }
```

---

## 프로젝트 구조

```
src/main/kotlin/com/mandalateu/
├── auth/
│   ├── controller/   AuthController.kt
│   ├── dto/          SignupRequest.kt, LoginRequest.kt, TokenResponse.kt
│   ├── service/      AuthService.kt
│   └── jwt/          JwtProvider.kt, JwtFilter.kt
├── user/
│   ├── domain/       User.kt (Entity)
│   └── repository/   UserRepository.kt
├── mandalart/
│   ├── controller/   MandalartController.kt
│   ├── dto/          MandalartCreateRequest.kt, MandalartResponse.kt
│   ├── service/      MandalartService.kt
│   ├── domain/       Mandalart.kt (Entity)
│   └── repository/   MandalartRepository.kt
├── strategy/
│   ├── controller/   StrategyController.kt
│   ├── dto/          StrategyUpdateRequest.kt, StrategyResponse.kt
│   ├── service/      StrategyService.kt
│   ├── domain/       Strategy.kt (Entity)
│   └── repository/   StrategyRepository.kt
├── actionitem/
│   ├── controller/   ActionItemController.kt
│   ├── dto/          ActionItemUpdateRequest.kt, ActionItemResponse.kt
│   ├── service/      ActionItemService.kt
│   ├── domain/       ActionItem.kt (Entity)
│   └── repository/   ActionItemRepository.kt
├── dashboard/
│   ├── controller/   DashboardController.kt
│   ├── dto/          WeeklyStatsResponse.kt, StreakResponse.kt, DeadlineResponse.kt
│   └── service/      DashboardService.kt
└── common/
    ├── config/       SecurityConfig.kt, JpaConfig.kt
    ├── exception/    GlobalExceptionHandler.kt, ErrorResponse.kt
    └── security/     UserDetailsServiceImpl.kt
```

---

## 작업 순서 및 TODO 체크리스트

### Phase 1 - 프로젝트 초기 설정

- [ ] Spring Boot 프로젝트 생성 (Gradle, Java 21)
- [ ] `build.gradle.kts` 의존성 추가
  - [ ] spring-boot-starter-web
  - [ ] spring-boot-starter-data-jpa
  - [ ] spring-boot-starter-security
  - [ ] spring-boot-starter-validation
  - [ ] mysql-connector-j
  - [ ] jjwt-api / jjwt-impl / jjwt-jackson
  - [ ] kotlin-reflect / kotlin-stdlib
- [ ] `application.yml` 기본 설정 (DB 연결, JPA, JWT secret)
- [ ] MySQL 데이터베이스 생성 (`mandalateu`)

### Phase 2 - 도메인 엔티티 및 Repository

- [ ] `User` 엔티티 작성
- [ ] `Mandalart` 엔티티 작성
- [ ] `Strategy` 엔티티 작성
- [ ] `ActionItem` 엔티티 작성 (Priority enum 포함)
- [ ] `UserRepository` 작성
- [ ] `MandalartRepository` 작성
- [ ] `StrategyRepository` 작성
- [ ] `ActionItemRepository` 작성

### Phase 3 - 인증 (JWT)

- [ ] `JwtProvider` 작성 (토큰 생성·검증·파싱)
- [ ] `JwtFilter` 작성 (`OncePerRequestFilter`)
- [ ] `SecurityConfig` 작성 (permitAll / authenticated 경로 설정)
- [ ] `UserDetailsServiceImpl` 작성
- [ ] `AuthService` 작성 (회원가입, 로그인, 토큰 재발급)
- [ ] `AuthController` 작성 (`POST /auth/signup`, `POST /auth/login`, `POST /auth/refresh`)

### Phase 4 - 만다라트 API

- [ ] `MandalartService` 작성
  - [ ] 생성 시 9개 Strategy + 각 9개 ActionItem 자동 초기화 로직
  - [ ] 소유자 검증 (다른 유저 접근 차단)
- [ ] `MandalartController` 작성 (GET 목록, POST, GET 상세, PATCH, DELETE)
- [ ] `MandalartResponse` DTO (strategies + actionItems 중첩 포함)

### Phase 5 - Strategy / ActionItem API

- [ ] `StrategyService` 작성 (title · color · notes PATCH)
- [ ] `StrategyController` 작성
- [ ] `ActionItemService` 작성 (title · completed · deadline · priority PATCH, `completedAt` 자동 설정)
- [ ] `ActionItemController` 작성

### Phase 6 - 대시보드 API

- [ ] `DashboardService` 작성
  - [ ] `getSummary` — 전체/Strategy별 진행률 계산
  - [ ] `getWeeklyStats` — 요일별 완료 수, 지난 주 대비 증감률
  - [ ] `getStreak` — `completedAt` 기반 연속 달성 계산
  - [ ] `getDeadlines` — 마감일 오름차순 정렬, 상태 분류 (TODAY/TOMORROW/SOON)
- [ ] `DashboardController` 작성

### Phase 7 - 예외 처리 및 검증

- [ ] `GlobalExceptionHandler` 작성 (`@RestControllerAdvice`)
  - [ ] `EntityNotFoundException` → 404
  - [ ] `AccessDeniedException` → 403
  - [ ] `MethodArgumentNotValidException` → 400
- [ ] `ErrorResponse` DTO 통일
- [ ] 각 Request DTO에 `@Valid` 검증 어노테이션 추가

---

## 신규 생성 파일 요약

```
src/main/kotlin/com/mandalateu/
├── auth/           4개 파일
├── user/           2개 파일
├── mandalart/      5개 파일
├── strategy/       5개 파일
├── actionitem/     5개 파일
├── dashboard/      3개 파일
└── common/         4개 파일
```

**총 약 28개 파일**
