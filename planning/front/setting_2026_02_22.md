# Settings Screen 기획 - 2026-02-22

## 현재 상태 및 문제점

현재 SettingsScreen은 다음 3가지만 존재:
- 앱 정보 (버전)
- 계정 (로그아웃)
- 데이터 관리 (데이터 초기화)

**문제점**
- 유저가 자신의 계정 정보를 확인할 방법이 없음
- Google OAuth 전환 시 닉네임/이메일을 어디서 확인하는지 불명확
- 앱 관련 정책 문서(이용약관, 개인정보처리방침) 접근 경로 없음
- 회원 탈퇴 기능 없음

---

## 신규 SettingsScreen 설계

### 화면 구성 (위 → 아래)

```
┌─────────────────────────────────────┐
│  설정                              │  ← 헤더
├─────────────────────────────────────┤
│                                     │
│  ┌─────────────────────────────┐    │
│  │  👤  닉네임                  │    │  ← 프로필 카드
│  │      user@gmail.com         │    │
│  └─────────────────────────────┘    │
│                                     │
│  ACCOUNT                            │  ← 섹션 헤더
│  ┌─────────────────────────────┐    │
│  │  닉네임 변경           >    │    │
│  ├─────────────────────────────┤    │
│  │  연결된 계정                │    │
│  │  Google · user@gmail.com    │    │
│  ├─────────────────────────────┤    │
│  │  로그아웃 (red)             │    │
│  └─────────────────────────────┘    │
│                                     │
│  APP                                │  ← 섹션 헤더
│  ┌─────────────────────────────┐    │
│  │  마감일 알림           🔔   │    │  ← 추후 구현
│  └─────────────────────────────┘    │
│                                     │
│  DATA                               │  ← 섹션 헤더
│  ┌─────────────────────────────┐    │
│  │  데이터 초기화 (red)        │    │
│  └─────────────────────────────┘    │
│                                     │
│  INFO                               │  ← 섹션 헤더
│  ┌─────────────────────────────┐    │
│  │  이용약관               >   │    │
│  ├─────────────────────────────┤    │
│  │  개인정보처리방침       >   │    │
│  ├─────────────────────────────┤    │
│  │  버전              1.0.0    │    │
│  └─────────────────────────────┘    │
│                                     │
│  ┌─────────────────────────────┐    │
│  │  회원 탈퇴 (gray, small)    │    │  ← 별도 섹션 최하단
│  └─────────────────────────────┘    │
│                                     │
│       MY MANDALATEU · v1.0.0        │  ← 푸터
└─────────────────────────────────────┘
```

---

## 섹션별 상세 기획

### 프로필 카드 (최상단)
- Google 계정 아이콘 (기본 아이콘 or 이니셜 원형)
- 닉네임 (굵게)
- 이메일 (회색, 작게)
- 데이터 출처: `authStore.user` (로그인 시 저장)
- **현재 `authStore.user`에 닉네임/이메일이 저장되지 않는 문제** → 백엔드 로그인 응답에 유저 정보 포함 필요

### ACCOUNT 섹션

| 항목 | 동작 | 우선순위 |
|------|------|----------|
| 닉네임 변경 | Alert 또는 모달로 인라인 편집 | Medium |
| 연결된 계정 | 읽기 전용 표시 (Google · 이메일) | Medium |
| 로그아웃 | Alert 확인 → 로그아웃 → Login 이동 | **완료** |

### APP 섹션

| 항목 | 동작 | 우선순위 |
|------|------|----------|
| 마감일 알림 | 토글 스위치, 알림 권한 요청 | Low (추후) |

### DATA 섹션

| 항목 | 동작 | 우선순위 |
|------|------|----------|
| 데이터 초기화 | Alert 확인 → 로컬 데이터 초기화 | **완료** |

### INFO 섹션

| 항목 | 동작 | 우선순위 |
|------|------|----------|
| 이용약관 | WebView 또는 외부 브라우저로 열기 | Low |
| 개인정보처리방침 | WebView 또는 외부 브라우저로 열기 | Low |
| 버전 | 읽기 전용 표시 | **완료** |

### 회원 탈퇴 (최하단 단독)
- 회색 텍스트로 강조 낮춤 (destructive하지만 실수 방지)
- Alert: "정말 탈퇴하시겠습니까? 모든 데이터가 삭제됩니다."
- 확인 시: 백엔드 회원 탈퇴 API → 로컬 데이터 초기화 → Login 이동
- **우선순위: Low** (법적 문서 정비 후 진행)

---

## 구현 순서 및 의존성

### Phase 1 - 즉시 구현 가능
- [x] 로그아웃 버튼 (완료)
- [ ] 프로필 카드 UI (닉네임, 이메일 표시)
  - **선행 조건**: `authStore.user`에 닉네임/이메일 데이터 있어야 함
  - **선행 조건**: 백엔드 Google 로그인 응답에 `user` 정보 포함 필요

### Phase 2 - 백엔드 연동 필요
- [x] 닉네임 변경
  - 백엔드: `PATCH /api/v1/users/me` 엔드포인트 (UserController, UserService, UpdateNicknameRequest)
  - 프론트: Modal + TextInput → userApi.updateNickname → authStore.updateNickname → user 상태 갱신
- [ ] INFO 섹션 (이용약관, 개인정보처리방침)
  - 문서 URL 확정 후 `Linking.openURL()` 또는 인앱 WebView

### Phase 3 - 추후
- [ ] 마감일 알림 토글 (Push Notification 설정 필요)
- [ ] 회원 탈퇴

---

## 선행 작업: 백엔드/authStore 수정 필요

현재 `authStore`의 `user` 필드가 `null` 상태임 (로그인 후에도 저장 안 됨).

### 백엔드 수정
Google 로그인 응답(`TokenResponse`)에 유저 정보 추가:
```kotlin
// 현재
data class TokenResponse(
    val accessToken: String,
    val refreshToken: String,
    val tokenType: String = "Bearer"
)

// 변경 후
data class TokenResponse(
    val accessToken: String,
    val refreshToken: String,
    val tokenType: String = "Bearer",
    val user: UserInfo
)

data class UserInfo(
    val id: Long,
    val email: String,
    val nickname: String
)
```

### 프론트 수정
```typescript
// authStore.setTokens → loginWithGoogle 완료 후 user 저장
setTokens: (accessToken, refreshToken, user?) => {
  set({ accessToken, refreshToken, isAuthenticated: true, user });
},
```

---

## 구현 우선순위 요약

| 우선순위 | 항목 | 비고 |
|----------|------|------|
| 1 | 백엔드 로그인 응답에 user 정보 포함 | 프로필 카드 표시를 위한 선행 작업 |
| 2 | authStore user 저장 | 위와 연동 |
| 3 | 프로필 카드 UI | 닉네임, 이메일, Google 뱃지 |
| 4 | 연결된 계정 표시 | 읽기 전용 |
| 5 | INFO 섹션 (버전 + 약관 링크) | 약관 문서 URL 필요 |
| 6 | 닉네임 변경 | PATCH API 필요 |
| 7 | 회원 탈퇴 | 법적 정비 후 |
| 8 | 마감일 알림 | 알림 권한 + 푸시 인프라 필요 |
